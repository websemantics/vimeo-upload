var VimeoUpload=function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,i){"use strict";t.__esModule=!0;var n=i(9),r=i(10),o=i(11),a=i(2),s=i(1),u=function(){function e(e){this.maxAcceptedUploadDuration=e}return e.DefaultResolver=function(e){var t=null;try{t=JSON.parse(e.response)}catch(i){t=e.response}var i=new o.Response(e.status,e.statusText,t);return i.responseHeaders=e.getAllResponseHeaders().split("\r\n").filter(function(e){return e.length>0}).map(function(e){var t=e.indexOf(":");return new r.Header(e.slice(0,t).trim(),e.slice(t+1).trim())}),e.status>308?i.statusCode=s.Status.Rejected:i.statusCode=s.Status.Resolved,i},e.prototype.send=function(t,i){return void 0===i&&(i=null),new Promise(function(n,r){var u=new XMLHttpRequest;u.open(t.method,t.url,!0),t.headers.forEach(function(e){return u.setRequestHeader(e.title,e.value)}),u.onload=function(){null!==i&&(i.end=new Date,i.done=!0);var t=e.DefaultResolver(u);switch(!0){case t.statusCode===s.Status.Resolved:n(t);break;default:r(t)}},u.onabort=function(){r(new o.Response(u.status,u.statusText,u.response))},u.onerror=function(){r(new o.Response(u.status,u.statusText,u.response))},null!=i&&u.upload.addEventListener("progress",function(e){e.lengthComputable&&(i.loaded=e.loaded,i.total=e.total,i.end=new Date,a.TimeUtil.TimeToSeconds(i.end.getTime()-i.start.getTime())>2*i.prefferedDuration&&(i.loaded=0,i.total=0,i.done=!0,u.abort()))});try{u.send(t.data)}catch(e){console.error("An error occured while sending.",e)}})},e.CreateRequest=function(e,t,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var a=[];for(var s in o)o.hasOwnProperty(s)&&a.push(new r.Header(s,o[s]));return new n.Request(e,t,i,a)},e}();t.HttpService=u},function(e,t,i){"use strict";t.__esModule=!0;!function(e){e[e.Neutral=0]="Neutral",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"}(t.Status||(t.Status={}))},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(){}return e.TimeToSeconds=function(e){return e/1e3},e.TimeToString=function(e){var t=new Date(null);return t.setTime(e),t.toISOString().substr(11,8)},e.MilisecondsToString=function(t){var i=e.TimeToSeconds(t),n=new Date(null);return n.setSeconds(i),n.toISOString().substr(11,8)},e}();t.TimeUtil=n},function(e,t,i){"use strict";t.__esModule=!0,t.VIMEO_ROUTES={DEFAULT:function(e){return void 0===e&&(e=""),"https://api.vimeo.com"+e},TICKET:function(){return t.VIMEO_ROUTES.DEFAULT()+"/me/videos"},VIDEOS:function(e){return""+t.VIMEO_ROUTES.DEFAULT("/videos/"+e)}}},function(e,t,i){"use strict";t.__esModule=!0,t.DEFAULT_VALUES={preferredUploadDuration:20,chunkSize:1048576,token:"TOKEN_STRING_HERE",supportedFiles:["mov","mpeg4","mp4","avi","wmv","mpegps","flv","3gpp","webm"],name:"",description:"",file:null,upgrade_to_1080:!1,timeInterval:150,maxAcceptedFails:20,maxAcceptedUploadDuration:60,useDefaultFileName:!1,retryTimeout:5e3,videoData:{}},t.DEFAULT_EVENTS={chunkprogresschanged:function(e){return console.log("Default: Chunk Progress Update: "+e.detail+"/100")},totalprogresschanged:function(e){return console.log("Default: Total Progress Update: "+e.detail+"/100")},vimeouploaderror:function(){},vimeouploadcomplete:function(){}}},function(e,t,i){"use strict";t.__esModule=!0;var n=i(4),r=function(){function e(){}return e.Add=function(e,t){window.addEventListener(e,t,!1)},e.Remove=function(e,t){window.removeEventListener(e,t,!1)},e.Dispatch=function(e,t){void 0===t&&(t=null);var i=new CustomEvent(e,{detail:t});window.dispatchEvent(i)},e.Exists=function(e){return n.DEFAULT_EVENTS.hasOwnProperty(e)},e.GetDefault=function(e){return n.DEFAULT_EVENTS[e]},e}();t.EventService=r},function(e,t,i){"use strict";t.__esModule=!0;var e,n=i(7);e.exports=n.App},function(e,t,i){"use strict";t.__esModule=!0;var n=i(8),r=i(13),o=i(15),a=i(4),s=i(5),u=i(16),c=i(17),d=i(0),l=i(19),p=function(){function e(){this.failCount=0}return e.prototype.init=function(e){void 0===e&&(e={});var t={};for(var i in a.DEFAULT_VALUES)a.DEFAULT_VALUES.hasOwnProperty(i)&&(t[i]=e.hasOwnProperty(i)?e[i]:a.DEFAULT_VALUES[i]);this.maxAcceptedFails=t.maxAcceptedFails,this.httpService=new d.HttpService(t.maxAcceptedUploadDuration),this.mediaService=new c.MediaService(this.httpService,t.file,t.videoData,t.upgrade_to_1080,t.useDefaultFileName),this.chunkService=new r.ChunkService(this.mediaService,t.preferredUploadDuration,t.chunkSize),this.statService=new l.StatService(t.timeInterval,this.chunkService),this.ticketService=new n.TicketService(t.token,this.httpService,t.upgrade_to_1080),this.uploadService=new o.UploadService(this.mediaService,this.ticketService,this.httpService,this.statService),this.validatorService=new u.ValidatorService(t.supportedFiles)},e.prototype.start=function(e){var t=this;void 0===e&&(e={}),this.init(e),this.validatorService.isSupported(this.mediaService.media.file)&&this.ticketService.open().then(function(e){console.log(e),t.ticketService.save(e),t.statService.start(),t.process()}).catch(function(i){t.canContinue()&&(t.failCount++,s.EventService.Dispatch("vimeouploaderror",{message:"Error creating ticket.",error:i}),setTimeout(function(){t.start(e)},t.retryTimeout))})},e.prototype.process=function(){var e=this,t=this.chunkService.create();this.uploadService.send(t).then(function(t){e.chunkService.updateSize(e.statService.getChunkUploadDuration()),e.check()}).catch(function(t){e.canContinue()&&(e.failCount++,s.EventService.Dispatch("vimeouploaderror",{message:"Error sending chunk.",error:t}),e.chunkService.updateSize(e.statService.getChunkUploadDuration()),setTimeout(function(){e.check()},e.retryTimeout))})},e.prototype.check=function(){var e=this;this.uploadService.getRange().then(function(t){switch(t.status){case 308:var i=t.responseHeaders.find(function(e){return(null!==e||void 0!==e)&&"Range"===e.title});if(e.chunkService.updateOffset(i.value),e.chunkService.isDone())return void e.done();e.process();break;case 200:e.done();break;default:console.warn("Unrecognized status code ("+t.status+") for chunk range.")}}).catch(function(t){s.EventService.Dispatch("vimeouploaderror",{message:"Unable to get range.",error:t}),e.canContinue()&&(e.failCount++,setTimeout(function(){e.check()},e.retryTimeout))})},e.prototype.done=function(){var e=this;this.statService.totalStatData.done=!0,this.ticketService.close().then(function(t){e.statService.stop();try{var i=parseInt(t.responseHeaders.find(function(e){return(null!==e||void 0!==e)&&"Location"===e.title}).value.replace("/videos/",""));e.updateVideo(i)}catch(e){console.log("Error retrieving Vimeo Id.")}console.log("Delete success:",t)}).catch(function(t){e.statService.stop(),s.EventService.Dispatch("vimeouploaderror",{message:"Unable to close upload ticket.",error:t})})},e.prototype.updateVideo=function(e){this.mediaService.updateVideoData(this.ticketService.token,e).then(function(t){var i=c.MediaService.GetMeta(e,t.data);s.EventService.Dispatch("vimeouploadcomplete",i)}).catch(function(t){s.EventService.Dispatch("vimeouploaderror",{message:"Unable to update video "+e+" with name and description.",error:t})})},e.prototype.on=function(e,t){void 0===t&&(t=null),s.EventService.Exists(e)&&(null===t&&(t=s.EventService.GetDefault(e)),s.EventService.Add(e,t))},e.prototype.off=function(e,t){void 0===t&&(t=null),s.EventService.Exists(e)&&(null===t&&(t=s.EventService.GetDefault(e)),s.EventService.Remove(e,t))},e.prototype.canContinue=function(){return 0===this.maxAcceptedFails||this.failCount<=this.maxAcceptedFails},e}();t.App=p},function(e,t,i){"use strict";t.__esModule=!0;var n=i(0),r=i(12),o=i(3),a=function(){function e(e,t,i){this.token=e,this.httpService=t,this.upgrade_to_1080=i}return e.prototype.open=function(){var e={type:"streaming"};this.upgrade_to_1080&&(e.upgrade_to_1080=this.upgrade_to_1080);var t=n.HttpService.CreateRequest("POST",o.VIMEO_ROUTES.TICKET(),JSON.stringify(e),{Authorization:"Bearer "+this.token,"Content-Type":"application/json"});return this.httpService.send(t)},e.prototype.save=function(e){this.ticket=new r.Ticket(e.data.upload_link_secure,e.data.ticket_id,e.data.upload_link,e.data.complete_uri,e.data.user)},e.prototype.close=function(){var e=n.HttpService.CreateRequest("DELETE",o.VIMEO_ROUTES.DEFAULT(this.ticket.completeUri),null,{Authorization:"Bearer "+this.token});return this.httpService.send(e)},e}();t.TicketService=a},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=[]),this.method=e,this.url=t,this.data=i,this.headers=n}return e}();t.Request=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t){this.title=e,this.value=t}return e}();t.Header=n},function(e,t,i){"use strict";t.__esModule=!0;var n=i(1),r=function(){function e(e,t,i){void 0===i&&(i=null),this.status=e,this.statusText=t,this.data=i,this.statusCode=n.Status.Neutral}return e}();t.Response=r},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n,r){this.uploadLinkSecure=e,this.ticketId=t,this.uploadLink=i,this.completeUri=n,this.user=r}return e}();t.Ticket=n},function(e,t,i){"use strict";t.__esModule=!0;var n=i(14),r=function(){function e(e,t,i,n){void 0===n&&(n=0),this.mediaService=e,this.preferredUploadDuration=t,this.size=i,this.offset=n}return e.prototype.updateSize=function(t){this.size=Math.floor(this.size*this.preferredUploadDuration/t*e.Adjuster)},e.prototype.create=function(){var e=Math.min(this.offset+this.size,this.mediaService.media.file.size);e-this.offset!==this.size&&this.updateSize(e-this.offset);var t=this.mediaService.media.file.slice(this.offset,e);return new n.Chunk(t,"bytes "+this.offset+"-"+e+"/"+this.mediaService.media.file.size)},e.prototype.updateOffset=function(e){this.offset=parseInt(e.match(/\d+/g).pop(),10)+1},e.prototype.isDone=function(){return this.offset>=this.mediaService.media.file.size},e.Adjuster=.7,e}();t.ChunkService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t){this.content=e,this.contentRange=t}return e}();t.Chunk=n},function(e,t,i){"use strict";t.__esModule=!0;var n=i(0),r=function(){function e(e,t,i,n){this.mediaService=e,this.ticketService=t,this.httpService=i,this.statService=n}return e.prototype.send=function(e){var t=this.statService.create();this.statService.save(t);var i=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,e.content,{"Content-Type":this.mediaService.media.file.type,"Content-Range":e.contentRange});return this.httpService.send(i,t)},e.prototype.getRange=function(){var e=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,null,{"Content-Type":this.mediaService.media.file.type,"Content-Range":"bytes */* "});return this.httpService.send(e)},e}();t.UploadService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e){this.supportedFiles=e}return e.prototype.isSupported=function(e){var t=e.type;if(-1===t.indexOf("/"))return console.warn("Wrong type found ("+t+")."),!1;var i=t.split("/");return"video"!==i[0]?(console.warn("Only videos are supported, "+t+" given."),!1):this.supportedFiles.includes(i[1])},e}();t.ValidatorService=n},function(e,t,i){"use strict";t.__esModule=!0;var n=i(18),r=i(0),o=i(3),a=function(){function e(e,t,i,r,o){this.httpService=e,o&&(i.name=t.name),this.media=new n.Media(t,i,r)}return e.prototype.updateVideoData=function(e,t){var i=this.media.data,n=Object.keys(i).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&");console.log(n);var a=r.HttpService.CreateRequest("PATCH",o.VIMEO_ROUTES.VIDEOS(t),n,{Authorization:"Bearer "+e});return this.httpService.send(a)},e.GetMeta=function(e,t){return{id:e,link:t.link,name:t.name,uri:t.uri,createdTime:t.created_time}},e}();t.MediaService=a},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i){this.file=e,this.data=t,this.upgrade_to_1080=i}return e}();t.Media=n},function(e,t,i){"use strict";t.__esModule=!0;var n=i(5),r=i(2),o=i(20),a=function(){function e(e,t){this.timeInterval=e,this.chunkService=t,this.si=-1,this.previousTotalPercent=0}return e.prototype.start=function(){this.totalStatData=this.create(!0),this.startInterval()},e.prototype.create=function(e){void 0===e&&(e=!1);var t=new Date,i=e?this.chunkService.mediaService.media.file.size:this.chunkService.size;return new o.StatData(t,t,this.chunkService.preferredUploadDuration,0,i)},e.prototype.save=function(e){this.chunkStatData=e},e.prototype.calculateRatio=function(e,t){return e/t},e.prototype.calculatePercent=function(e,t){return Math.floor(100*this.calculateRatio(e,t))},e.prototype.updateTotal=function(){this.totalStatData.loaded+=this.chunkStatData.total},e.prototype.startInterval=function(){var e=this;this.si>-1&&this.stop(),this.si=setInterval(function(){var t=e.calculatePercent(e.chunkStatData.loaded,e.chunkStatData.total);e.chunkStatData.done&&(e.updateTotal(),e.chunkStatData.total=e.chunkStatData.loaded=0,t=100),e.totalStatData.loaded=Math.max(e.chunkService.offset,e.totalStatData.loaded),e.totalStatData.end=e.chunkStatData.end,e.previousTotalPercent=Math.max(e.totalStatData.loaded+e.chunkStatData.loaded,e.previousTotalPercent);var i=e.calculatePercent(e.previousTotalPercent,e.totalStatData.total);n.EventService.Dispatch("chunkprogresschanged",t),e.totalStatData.done&&(i=100),n.EventService.Dispatch("totalprogresschanged",i)},this.timeInterval)},e.prototype.stop=function(){clearInterval(this.si)},e.prototype.getChunkUploadDuration=function(){return r.TimeUtil.TimeToSeconds(this.chunkStatData.end.getTime()-this.chunkStatData.start.getTime())},e.prototype.chunkIsOverPrefferedUploadTime=function(){return this.getChunkUploadDuration()>=1.5*this.chunkService.preferredUploadDuration},e}();t.StatService=a},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n,r,o){void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=!1),this.start=e,this.end=t,this.prefferedDuration=i,this.loaded=n,this.total=r,this.done=o}return e}();t.StatData=n}]);